<script>
    async function startScanning() {
        try {
            // Check for mobile device
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            
            // Request camera permission with appropriate constraints
            const stream = await navigator.mediaDevices.getUserMedia({ 
                video: {
                    facingMode: isMobile ? "environment" : "user",
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            });
            
            // Initialize Quagga after permission is granted
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector("#interactive"),
                    constraints: {
                        facingMode: isMobile ? "environment" : "user",
                    },
                },
                decoder: {
                    readers: [
                        "ean_reader",
                        "ean_8_reader",
                        "code_128_reader",
                        "code_39_reader",
                        "upc_reader"
                    ]
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    alert("Error initializing scanner: " + err);
                    return;
                }
                console.log("Quagga initialization succeeded");
                Quagga.start();
            });

        } catch (error) {
            alert("Camera access denied or error occurred. Please ensure camera permissions are granted.");
            console.error("Error:", error);
        }
    }

    // Add error handling
    window.onerror = function(msg, url, lineNo, columnNo, error) {
        console.error('Error: ' + msg + '\nURL: ' + url + '\nLine: ' + lineNo + '\nColumn: ' + columnNo + '\nError object: ' + JSON.stringify(error));
        return false;
    };
</script>
<div id="debug-info" style="display:none;">
    <p>Debug Information:</p>
    <pre id="debug-text"></pre>
</div>

<script>
    function logDebug(message) {
        const debugText = document.getElementById('debug-text');
        debugText.textContent += new Date().toISOString() + ': ' + message + '\n';
    }
</script>
